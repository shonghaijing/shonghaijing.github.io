<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
		<title></title>
		<link rel="stylesheet" type="text/css" href="../css/reset.css" />
		<link rel="stylesheet" href="../css/shop_car.css" />
		<script type="text/javascript" src="../js/jquery-1.11.3.min.js"></script>
	</head>
     <script type="text/javascript">
	document.documentElement.style.fontSize = innerWidth / 16 + 'px';
	onresize = function() {
		document.documentElement.style.fontSize = innerWidth / 16 + 'px';
	};
</script>
<style type="text/css">
    #ding{width:100%;background:#fff;z-index: 4;}    
	#box{width:100%;min-height: 4.5rem;margin-bottom: 4.5rem;}
	.hide{width:9.35rem;height:4.5rem;display:none;position:absolute;right:0;}
	.show{width:9.35rem;height:4.5rem;display:block;position:absolute;right:0;}
	.zh_r_right{
	display: block;
	width: 2.2rem;
	height: 4.45rem;
	background:#fe651f;
	float: right;
	text-align: center;
	line-height:  4.45rem;
	color: #fff;
}
.zh_detail_c {
	display: block;
	margin-top: 0.25rem;
	float: left;
	height: 1.8rem;
	
	width: 7.15rem;
	border-bottom:0.025rem solid #fff;
	
}

.zh_pz{

	display: block;
	width: 2.125rem;
	height: 1.8rem;
	float: left;
	text-align: center;
	line-height:  1.8rem;
	
	border-right:0.025rem solid #fff;
	
}
.zh_px{

	display: block;	
	width: 2.8rem;
	height: 1.8rem;
	float: left;
	text-align: center;
	line-height:  1.8rem;
	border-right:0.025rem solid #fff;

}
.zh_pc{
	
	display: block;
	width: 2.125rem;
	height: 1.8rem;
	float: left;
	text-align: center;
	line-height:  1.8rem;
}
.zh_detail_c p a {
	color: #f82e00;
	margin-right: 0.3rem;
}

.zh_detail_c p b {
	text-align: right;
	float: right;
	font-weight: none;
	margin-top: 0.1rem;
}
.zh_top{
	width: 7.15rem;
	float: left;
}
.zh_detail_d{
	display: block;
	padding-left: 0.4rem;
}
.zh_detail_d b{
	padding-top: 0.1rem;
	font-size: 0.4rem;
	color: #919191;
	width:85%;
	word-wrap: break-word;
	float: left;
}
.zh_detail_d img{
	padding-top: 0.85rem;
	margin-left:0.2rem;
	width: 0.55rem;
	height: 0.325rem;
	float:left;
}
.zhi{font-size:0.4rem}
</style>
	<body>
		
		   <div id="ding">
			<div class="zh_shopbox">
				<a href="lxc_homepage.html" class="zh_back"><img src="../img/zh_big.jpg" /></a>
				<p class="zh_shopcar">购物车(<span id="zhi"></span>)</p>
				<a href="javascript:;" class="zh_bianji" id="bian1">编辑</a>
				<img src="../img/zh_news.jpg" class="zh_news" />
			</div>
			
			<div class="zh_name">
				<a href="javascript:;" class="zh_binggo"><img src="../img/zh_binggo.jpg" /></a>
				<img src="../img/zh_chao.jpg" class="zh_chao" />
				<p class="zh_ondhurd">百家乐超市华北站</p>
				<img src="../img/zh_bigone.jpg" class="zh_bigone" />
				<p class="zh_bianjia" id="bian">编辑</p>
				<p class="ok" id="ok">完成</p>
			</div>
	        </div>
	    <div id="box">
			<!--<div class="zh_boxone" id="zh_boxone">
				<a href="javascript:;" class="zh_binggo_A yuan1" ></a>
				
				<a href="javascript:;" class="zh_binggo_B"><img src="../img/zh_dao.jpg" /></a>
				<div class="show">
					<span class="zh_detail_a">
						<p>【百家乐超市】稻香村510g</p>
						<p>中华老字号中华月饼礼袋糕点心</p>
					</span>	
					<span class="zh_detail_a">
						<p>
							<a href="javascript:;">¥29.9</a>
							10.2kg
							<b>x20</b>
						</p>
						
					</span>
				</div>
				<div class="hide">
					<div class="zh_top">
					<span class="zh_detail_c">
						<p class="zh_pz" id="jia">+</p>						
						<p class="zh_px" id="ling">0</p>
						<p class="zh_pc" id="jian">－</p>						
					</span>	
					<span class="zh_detail_d">
							<b>食品口味：奶油口味</b>
							<img src="../img/zh_xiala.jpg" alt="">
					</span>	
				    </div>	
				     <a class="zh_r_right" id="del">删除</a>
			    </div>
			</div>-->
			
		</div>
		<div class="zh_price_box">
			<div class="zh_price-one">
				<a href="javascript:;" class="zh_binggoa"></a>
				
				<p class="zh_select" id="zh_select">全选</p>
				<span class="zh_our">
					<p class="zh_total">合计:<span id="heji"></span></p>
					<p class="zh_weight">(<span id="weight"></span>)</p>
				</span>
				<a href="javascript:;" class="zh_balance" id="jiesuan">结算</a>
			</div>
			<ul class="footer" id="footer">
				<li>
					<a href="lxc_homepage.html">
						<!--<img src="../img/s-footer-tu1.png">--><b></b><span>首页</span> </a>
				</li>
				<li>
					<a href="#">
						<!--<img src="../img/s-footer-tu2.png">--><b></b><span>微淘</span></a>
				</li>
				<li>
					<a href="#">
						<!--<img src="../img/s-footer-tu3.png">--><b></b><span>社区</span></a>
				</li>
				<li>
					<a href="#">
						<!--<img src="../img/s-footer-tu4.png">--><b></b><span>购物车</span></a>
				</li>
				<li>
					<a href="myinstall.html">
						<!--<img src="../img/s-footer-tu5.png">--><b></b><span>我的淘宝</span></a>
				</li>
			</ul>
		</div>
		<script type="text/javascript">
          var oDiv=document.getElementById('footer')
		var oSpan=oDiv.getElementsByTagName('a')
		var oP=oDiv.getElementsByTagName('span')
		var oB=oDiv.getElementsByTagName('b')
		for(var i=0;i<oSpan.length;i++){
			oSpan[i].index=i
			oSpan[i].onclick=function(){
				for(var i=0;i<oSpan.length;i++){
					oB[i].className=''
					oP[i].style.color=''
				}
				oB[this.index].className='active'
				oP[this.index].style.color='#fb3700'
			}
			   oB[3].className='active'
				oP[3].style.color='#fb3700'
		}
		
		</script>
		<script type="text/javascript">
		$(function(){
	//导航吸顶条
		var Shopbox = document.getElementById('ding');
		var Top = Shopbox.offsetTop;
		window.onscroll = function(){
			var scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
			if(Top<=scrollTop){
				Shopbox.style.position = 'relative';
			}else{
				Shopbox.style.position = '';
			}
		}
		
	  
		 var arr = []
		 var arr1 = []
		 var arr2 = []
		  var arr3 = []
		 
		 var show=document.getElementsByClassName("show")
		 var hide=document.getElementsByClassName("hide")
		bian.onclick=bian1.onclick=function(){
			if(bian.innerHTML=="编辑"&&bian1.innerHTML=="编辑"){
				ok.style.display="block"
				bian1.innerHTML="";
				//bian.innerHTML="完成";
				bian.style.display="none"
				
				for(var i = 0;i<hide.length;i++){
					 show[i].style.display ='none'
					 hide[i].style.display = 'block'
				}
              
			}else{
				//bian.innerHTML="编辑"
				bian1.innerHTML="编辑"
				bian.style.display="block"
				ok.style.display="none"
				
				for(var i = 0;i<show.length;i++){
					window.location.reload()
				   show[i].style.display ='block'
				   hide[i].style.display = 'none'
				  }
				
			    }
			
			}
        //判断编辑
       ok.onclick=function(){
       	ok.innerHTML="编辑"
       	window.location.reload()
       	
       	//Binjidatas()
       }
        

	//获取登录用户手机号
	var user_phone = localStorage.getItem('user_phone')
	//执行ajax  查看购物车
	$.ajax({
		url: "http://10.115.11.224/supermarket/data/get_commodity_car.php",
		async:true,
		data:{'user_phone':user_phone},
		dataType:'jsonp',
		jsonp:'callback',
		jsonpCallback:'success_JsonpCallback',
		success:function(data){
			if(data&&data.length>0){
				for(var i =0;i<data.length;i++){
					arr.push(data[i].commodity_id);
					arr1.push(data[i].count)
					
				}
				 zhi.innerHTML=data.length
				if(arr.length>0){
					feng()
				}
			}
			
		}
	})
   //封装函数  获取商品详情
   var i = 0;
	function feng(){
			$.ajax({
			url:"http://10.115.11.224/supermarket/data/get_commodity_info.php",
			async:true,
			data:{'id':arr[i]},
			dataType:'jsonp',
			jsonp:'callback',
	//		jsonpCallback:'success_JsonpCallback',
				success:function(data2){
					//debugger
					
					if(data2!=null){
						var html = ''
						html+='<div class="zh_boxone"><a href="javascript:;" class="zh_binggo_A "></a><a href="bxy_information.html?id='+data2.id+'" class="zh_binggo_B"><img src="http://10.115.11.224/supermarket/img/'+data2.classify+'/'+data2.img+'" /></a><div class="show"><span class="zh_detail_a"><p>'+data2.name+'</p></span><span class="zh_detail_a"><p><a href="javascript:;" id="abc">¥<span>'+data2.price+'</span></a><weight id="tj"><span>'+data2.weight+'<span></weight><b id="ab">x<count>'+arr1[i]+'</count></b></p></span></div><div class="hide"><div class="zh_top"><span class="zh_detail_c"><p class="zh_pz" name ="'+data2.id+'">+</p><p class="zh_px" id="yi">'+arr1[i]+'</p><p class="zh_pc" name ="'+data2.id+'">－</p></span><span class="zh_detail_d"><b></b><img src="../img/zh_xiala.jpg" alt=""></span></div><a class="zh_r_right" name="'+data2.id+'">删除</a></div></div>'
						
					}	
					


					
					  var zongjia=0;
		             
		              var money = 0;
		              
		             zongjia+=Number(data2.price*arr1[i])
		             arr2.push(zongjia)
		             for(x in arr){
		             	money+=parseFloat(arr2[x])
		             	
		             }
		           $("#heji").text("￥" + parseFloat(money).toFixed(2));
		               
						var zhongliang=0;
		                var wei=0;
		              
						var a = data2.weight.replace("kg", "");
						zhongliang += Number(a*arr1[i])
						console.log(zhongliang)
						arr3.push(zhongliang)
						for(y in arr){
		             	wei+=parseFloat(arr3[y])
		             
		            } 
						 console.log(wei)
						$("#weight").text(parseFloat(wei).toFixed(2) + "kg");	
		
					$('#box').append(html)	
						if(i<arr.length){
							i++
							feng()
						}
					
				var del=document.getElementsByClassName("zh_r_right");
					for(i=0;i<del.length;i++){
						 del[i].onclick=function(){
						 id=this.name
						 	$.ajax({
								url:"http://10.115.11.224/supermarket/data/my_commodity_delete_car.php",
								async:true,
								data:{'user_phone':user_phone,'commodity_id':id},
								dataType:'jsonp',
								jsonp:'callback',
								jsonpCallback:'success_JsonpCallback',
									success:function(data){
										window.location.reload();

									},error:function(){}
									})
						 }
					}
				//删除商品ajax	
				var jia1=document.getElementsByClassName("zh_pz");
				for(j = 0;j<jia1.length;j++){
					jia1[j].onclick = function(){
						var id = $(this).attr('name')
						this.parentNode.children[1].innerHTML++
						var nu1 = this.parentNode.children[1].innerHTML
						Binjidatas(id,nu1)
					}
				}
				var jian1=document.getElementsByClassName("zh_pc");
				
                for(q = 0;q<jian1.length;q++){
					jian1[q].onclick = function(){
						
						var id1 = $(this).attr('name')
                         if(this.parentNode.children[1].innerHTML==1){
                         	
                         }else{this.parentNode.children[1].innerHTML--}
						
						var nu2 = this.parentNode.children[1].innerHTML
						Binjidatas(id1,nu2)
					}
				}
						 
                   
         function Binjidatas(ids,mn){
         		$.ajax({
					url:"http://10.115.11.224/supermarket/data/my_commodity_update_car.php",
					async:true,
					data:{'user_phone':user_phone,'commodity_id':ids,'count':mn},
					dataType:'jsonp',
					jsonp:'callback',
					jsonpCallback:'success_JsonpCallback',
					success:function(data){
//						window.location.reload();

					}
					})
         }
	       //编辑购物车ajax     
	            
	           
	            
				}
			    
			
			})
	}
  
    var user_name1=localStorage.getItem("user_name");
    var user_phone = localStorage.getItem('user_phone')	
	var user_addr = localStorage.getItem('user_addr')
	var arr4=user_addr.split(',')
	var user_name1=arr4[3]
	var user_addr1=arr4[0]+arr4[1]+arr4[2]
	var user_tel=arr4[4]

	$("#jiesuan").click(function(){
		for(i=0;i<arr.length;i++){
			$.ajax({
					url:"http://10.115.11.224/supermarket/data/my_commodity_order.php",
					async:true,
					data: {'commodity_id': arr[i],'user_phone':user_phone,'count':arr1[i],'user_name':user_name1,'user_addr':user_addr,'consignee_phone':user_tel},
					dataType:'jsonp',
					jsonp:'callback',
					//jsonpCallback:'success_JsonpCallback',
						success:function(data){
							debugger
							window.location.href="deal.html"

						},error:function(){}
						})
		}
	})
		
	
    
})

		</script>
	</body>

</html>
